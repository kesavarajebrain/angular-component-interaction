<div class="container mt-3">
    <p routerLink="/forms">
        <a class="pe-auto text-secondary text-decoration-none"><-Back </a>
    </p>
    <h4>Advanced Reactive forms</h4>
    <div class="row">
        <div class="col">
            <ul>
                <li>Where backend sends JSON ‚Üí frontend builds the form automatically.</li>
                <li>All validation, rules, logic live in TypeScript.</li>
                <li>Reactive forms are best for real-world apps (Admin panels,CMS systems).</li>
            </ul>
        </div>
        <div class="col">
            üî¥ Level 3 ‚Äî Advanced Reactive Forms
            <ul>
                <li> ‚úÖ JSON-based Dynamic Forms
                </li>
                <li> ‚úÖ Custom Validators
                </li>
                <li> ‚úÖ Conditional Validators
                </li>
                <li> ‚úÖ Async Validators
                </li>
                <li> ‚úÖ Dynamic validators
                </li>
                <li> ‚úÖ Auto-save using valueChanges
                </li>
                <li> ‚úÖ Dynamic enable/disable controls
                </li>
                <li> ‚úÖ Conditional fields
                </li>
            </ul>
        </div>
    </div>
    <div class="row">
        <div class="col alert alert-success">
            <h5>JSON-based Dynamic Forms</h5>
            <ul>
                <li>Form structure is NOT fixed in HTML</li>
                <li>Form is generated from JSON (API Response)</li>
            </ul>
        </div>
        <div class="col alert alert-primary">
            <h5> Custom Validators </h5>
            <ul>
                <li>Password and confirmPassword validation</li>
            </ul>
        </div>
        <div class="col alert alert-secondary">
            <h5> Conditional Validators </h5>
            <ul>
                <li>‚ÄúDepending on country, which document should the user submit?‚Äù</li>
                <li>Only one document is required depending on nationality</li>
                <li>Conditional validation decides which field must be validated.</li>
            </ul>
        </div>
        <div class="col alert alert-warning">
            <h5> Async Validators </h5>
            <ul>
                <li>Based on the api response validation</li>
                <li>if the user enters email check it whether already registred or not like that</li>
                <li>Enter following and test async validation - test&#64;gmail.com,
                    admin&#64;gmail.com</li>
            </ul>
        </div>
    </div>
    <div class="row">
        <div class="col alert alert-info">
            <h5> Dynamic Validators </h5>
            <ul>
                <li>Dynamic validation decides how a field must be validated.</li>
            </ul>
        </div>
        <div class="col alert alert-danger">
            <h5> Auto-save using valueChanges
            </h5>
            <ul>
                <li>Auto save will help long form, never lose the process. </li>
            </ul>
        </div>
        <div class="col alert alert-success">
            <h5> Dynamic enable / disable controls
            </h5>
            <ul>
                <li>Enable or disable controls based on other field values</li>
                <li>Here managing the Appiled before field based on the disabled the reason field </li>
            </ul>
        </div>
        <div class="col alert alert-dark">
            <h5> Conditional fields
            </h5>
            <ul>
                <li>Fields that appear or disappear based on the value of another field.</li>
                <li>Here managing the differently abled field based on differentlyAbled select box field </li>
            </ul>
        </div>
    </div>
    <div class="row">
        <div class="col">
            <div class="container alert alert-success card p-4 mt-4">
                <h6>This form covers JSON-based Dynamic Forms ** Custom Validators & Conditional Validators ** Async
                    Validators ** Dynamic validators ** Dynamic Enable , Disable controls ** Conditional Fields</h6><br>
                <h5 class="text-center">VISA APPLICATION FORM</h5>

                <form [formGroup]="dynamicForm" (ngSubmit)="onSubmit()">
                    <div *ngFor="let field of formConfig" class="mb-3 mt-3">

                        <!-- ‚úÖ TEXT, EMAIL (NON-GROUP, NON-SELECT, NON-RADIO, NON-CHECKBOX) -->
                        <ng-container *ngIf="field.type !== 'group' &&
             field.type !== 'select' &&
             field.type !== 'radio' &&
             field.type !== 'checkbox' &&  isFieldVisible(field)">
                            <label class="form-label">{{ field.label }}</label>
                            <input class="form-control" [type]="field.type" [formControlName]="field.name"
                                [placeholder]="field.placeholder">

                            <!-- ‚è≥ LOADING -->
                            <small class="text-danger" *ngIf="dynamicForm.get(field.name)?.pending">
                                Checking email availability...
                            </small>

                            <!-- ‚ùå EMAIL EXISTS -->
                            <small class="text-danger" *ngIf="dynamicForm.get(field.name)?.errors?.['emailExists']">
                                Email already registered
                            </small>

                            <small class="text-danger" *ngIf="
          dynamicForm.get(field.name)?.invalid && !dynamicForm.get(field.name)?.errors?.['emailExists'] &&
          (dynamicForm.get(field.name)?.touched || submitted)
        ">
                                {{ field.label }} is required
                            </small>

                            <small class="text-danger" *ngIf="
    field.name === 'companyName' &&
    dynamicForm.get('companyName')?.hasError('required') &&
    (dynamicForm.get('companyName')?.touched || submitted)
  ">
                                When Employment Type is Employed
                            </small>
                        </ng-container>

                        <!-- ‚úÖ GROUP (Password + Confirm Password) -->
                        <ng-container *ngIf="field.type === 'group'" [formGroupName]="field.name">
                            <div *ngFor="let child of field.fields" class="mb-2">
                                <label class="form-label">{{ child.label }}</label>
                                <input class="form-control" [type]="child.type" [formControlName]="child.name"
                                    [placeholder]="child.placeholder">
                                <!-- ‚úÖ Field-level error -->
                                <small class="text-danger" *ngIf="
            dynamicForm.get(field.name + '.' + child.name)?.invalid &&
            (dynamicForm.get(field.name + '.' + child.name)?.touched || submitted)
          ">
                                    {{ child.label }} is invalid
                                </small>
                            </div>

                            <!-- ‚úÖ GROUP-LEVEL PASSWORD MISMATCH ERROR -->
                            <small class="text-danger fw-bold" *ngIf="
          dynamicForm.get(field.name)?.errors?.['passwordMismatch'] &&
          (dynamicForm.get(field.name)?.touched || submitted)
        ">
                                Password and Confirm Password do not match
                            </small>
                        </ng-container>

                        <!-- ‚úÖ SELECT -->
                        <ng-container *ngIf="field.type === 'select'">
                            <label class="form-label">{{ field.label }}</label>
                            <select class="form-control form-select" [formControlName]="field.name">
                                <option value="">-- Select --</option>
                                <option *ngFor="let opt of field.options" [value]="opt">
                                    {{ opt }}
                                </option>
                            </select>
                            <small class="text-danger" *ngIf="
          dynamicForm.get(field.name)?.invalid &&
          (dynamicForm.get(field.name)?.touched || submitted)
        ">
                                {{ field.label }} is required
                            </small>
                        </ng-container>

                        <!-- ‚úÖ RADIO -->
                        <ng-container *ngIf="field.type === 'radio'">
                            <label class="form-label d-block">{{ field.label }}</label>
                            <label *ngFor="let opt of field.options" class="me-3">
                                <input class="form-check-input" type="radio" [formControlName]="field.name"
                                    [value]="opt">
                                {{ opt }}
                            </label>
                            <br>
                            <small class="text-danger" *ngIf="
          dynamicForm.get(field.name)?.invalid &&
          (dynamicForm.get(field.name)?.touched || submitted)
        ">
                                {{ field.label }} is required
                            </small>
                        </ng-container>

                        <!-- ‚úÖ CHECKBOX -->
                        <ng-container *ngIf="field.type === 'checkbox'">
                            <label>
                                <input class="form-check-input" type="checkbox" [formControlName]="field.name">
                                {{ field.label }}
                            </label>
                            <br>
                            <small class="text-danger" *ngIf="
          dynamicForm.get(field.name)?.invalid &&
          (dynamicForm.get(field.name)?.touched || submitted)
        ">
                                You must accept the terms
                            </small>
                        </ng-container>

                    </div>
                    <button class="btn btn-primary">Submit</button>
                </form>

                <hr>
                <h4>Live Form Value</h4>
                <pre>{{ dynamicForm.value | json }}</pre>
            </div>
        </div>
        <div class="col">
            <div class="container alert alert-primary card p-4 mt-4">
                <h6>This form covers Auto-save using valueChanges</h6><br>
                <h5 class="text-center">Auto save Form</h5>
                <form [formGroup]="profileForm">
                    <ng-container>
                        <label>Name</label>
                        <input type="text" class="form-control" formControlName="name">
                    </ng-container>
                    <ng-container>
                        <label>Email</label>
                        <input type="email" class="form-control" formControlName="email">
                    </ng-container>
                    <ng-container>
                        <label>Bio</label>
                        <textarea class="form-control" formControlName="bio"></textarea>
                    </ng-container>
                    <br>
                    <p *ngIf="isSaving">üíæ Saving draft...</p>
                    <button type="button" class="btn btn-info" (click)="clearDraft()">Clear Draft</button> &nbsp;
                    <button type="button" class="btn btn-primary" (click)="patchValue()">Patch Value</button> &nbsp;
                    <button type="button" class="btn btn-secondary" (click)="setValue()">Set Value</button>
                </form>
            </div>
            <div class="container alert alert-warning">
                <p><b>PATCH value</b> - we can patch single or mutiple fields also, no need to configure all the fields
                    what ever we patched fields that only going to update in the form remaining all will be remains the
                    same
                </p>
                <p><b>SET value</b>- we need to pass all the fileds if any field we missed it will throw a error like
                    below</p>
                <div class="card alert alert-danger">
                    <b>ERROR RuntimeError: NG01002: Must supply a value for form control with name: 'bio'</b>
                </div>
            </div>
            <div class="conatiner alert alert-info">
                <b>Why we can use traditional update the form using ngModal?</b>
                <pre>

user = &#123;
  fullName: '',
  email: '',
  password: '',
  confirmPassword: '',
  gender: '',
  country: '',
  terms: false
&#125;;

And in template (template-driven form):

&#60;input [(ngModel)]="user.fullName"&#62;
&#60;input [(ngModel)]="user.email"&#62;
                </pre>
                <p>Then when API response comes: <br>
                    <span> this.user.fullName = api.fullName;</span> <br>
                    <span> this.user.email = api.email;</span><br><br>
                    <span>‚úÖ YES ‚Äî UI updates automatically</span><br>
                    <span>‚úÖ YES ‚Äî ngModel handles this</span><br>
                    <span>‚ùå NO ‚Äî this does not involve patchValue</span><br>
                    <span> So far, your understanding is correct.</span><br><br>
                    <span>‚ùå Do NOT mix ngModel with Reactive Forms</span><br>
                    <span>‚ùå Do NOT update objects directly in Reactive Forms</span><br>
                    <span>‚úÖ Update the FormGroup using patchValue</span><br>
                    <span>patchValue is the reactive-forms equivalent of
                        updating the model object in ngModel</span><br>
                    <span><b>ngModel updates objects</b> ‚Üí UI updates</span><br>
                    <span><b>Reactive Forms update FormGroup</b> ‚Üí UI updates</span><br> <br>
                    <span>‚ùå formControlName does NOT replace ngModel </span><br>
                    <span>‚ùå ngModel does NOT replace patchValue</span> <br>
                    <span>‚úÖ They belong to different form systems</span>
                </p>
                <pre>
(Template-Driven, reactive-forms)
|      Looks same                    Actually is  
| ---------------------------- | --------------------------- |
| `name="fullName"`            | HTML attribute              |
| `formControlName="fullName"` | Angular directive           |
                    </pre>
                <b>üß† What is updateValueAndValidity()?</b> <br>
                <span>It tells Angular: ‚ÄúRecalculate this control‚Äôs value, validation status, and errors NOW.‚Äù</span>
                <pre>
‚úÖ MUST call when:
Adding/removing validators
Changing async validators
Dynamic validation rules
Enabling/disabling controls conditionally
If you change validators ‚Üí call updateValueAndValidity()
                    </pre>
            </div>
        </div>
    </div>
    <div class="row">
        <div class="container alert alert-light">
            <pre>            {{tsCode}}
</pre>
        </div>
    </div>
</div>