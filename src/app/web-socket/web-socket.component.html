<div class="container mt-3">
    <p routerLink="/">
        <a class="pe-auto text-secondary text-decoration-none"> <-Back </a>
    </p>
    <h4>Web Socket</h4>
    <p>A WebSocket is a protocol that creates a persistent, two-way connection between a client (browser/app) and a
        server.
        WebSocket роОройрпНрокродрпБ роТро░рпБ communication protocol (родрпКроЯро░рпНрокрпБ ро╡ро┐родро┐роорпБро▒рпИ).</p>
    <p>роЗродройрпН роорпБроХрпНроХро┐роп ро╡рпЗро▓рпИ: <br>
        ЁЯСЙ Browser / App (Client) рооро▒рпНро▒рпБроорпН Server роЗро╡ро▒рпНро▒рпБроХрпНроХрпБ роЗроЯрпИропро┐ро▓рпН роТро░рпБ роирпАрогрпНроЯ роирпЗро░роорпН родро┐ро▒роирпНродрпЗ роЗро░рпБроХрпНроХрпБроорпН connection
        роЙро░рпБро╡ро╛роХрпНроХрпБро╡родрпБ. <br>
        ЁЯСЙ роЕродро┐ро▓рпН роЗро░рпБ рокроХрпНроХроорпБроорпН (two-way) роОрокрпНрокрпЛродрпБ ро╡рпЗрогрпНроЯрпБрооро╛ройро╛ро▓рпБроорпН data роЕройрпБрокрпНрок роорпБроЯро┐ропрпБроорпН.</p>
    <p>тЬЕ WebSocket роОройрпНрокродрпБ роТро░рпБ protocol - (роЕродро╛ро╡родрпБ тАУ client рооро▒рпНро▒рпБроорпН server роОрокрпНрокроЯро┐ рокрпЗроЪ ро╡рпЗрогрпНроЯрпБроорпН роОройрпНрокродро▒рпНроХро╛рой ро╡ро┐родро┐) <br>
        тЬЕ роЕродрпБ persistent connection роЙро░рпБро╡ро╛роХрпНроХрпБроорпН - (роТро░рпБ роорпБро▒рпИ connect роЖрой рокро┐ро▒роХрпБ close роЖроХро╛рооро▓рпН родрпКроЯро░рпНроирпНродрпБ open роЖроХ роЗро░рпБроХрпНроХрпБроорпН)
        <br>
        тЬЕ роЕродрпБ two-way connection - (client тЖТ server роороЯрпНроЯрпБрооро▓рпНро▓, server тЖТ client роХрпВроЯ роЙроЯройрпЗ message роЕройрпБрокрпНрок роорпБроЯро┐ропрпБроорпН)
    </p>
</div>
<div class="container alert alert-info">
    <div class="row">
        <div class="col">
            <pre>
<b>роЪро╛родро╛ро░рог HTTP:</b>
    ЁЯСд Client: тАЬUpdate роЗро░рпБроХрпНроХро╛?тАЭ
    ЁЯЦе Server: тАЬроЗро▓рпНро▓тАЭ
    (Connection close)

роорпАрогрпНроЯрпБроорпНтАж
    ЁЯСд Client: тАЬUpdate роЗро░рпБроХрпНроХро╛?тАЭ
    ЁЯЦе Server: тАЬроЗро░рпБроХрпНроХрпБ!тАЭ

ЁЯСЙ роЗродрпБ slow + wasteful.
            </pre>
            <hr>
            <p><b>ЁЯМР HTTP (Traditional Web Requests)</b></p>
            <p>HTTP works in a requestтАУresponse model.</p>
            <p>Flow:</p>
            <ul>
                <li>1я╕ПтГг Client sends request
                </li>
                <li>2я╕ПтГг Server processes it
                </li>
                <li>3я╕ПтГг Server sends response
                </li>
                <li>4я╕ПтГг Connection closes
                </li>
            </ul>
            <b>If the client wants new data later тЖТ it must send another request.
            </b>
            <ul>
                <li> <b>тЭМ Problems with HTTP for real-time:</b>
                </li>
                <li> Wastes bandwidth
                </li>
                <li>Slower updates
                </li>
                <li>Creates many requests
                </li>
                <li>Server load increases
                </li>
                <li>Not truly real-time
                </li>
            </ul>
        </div>
        <div class="col">
            <pre>
<b>WebSocket:</b>
    ЁЯСд Client connect роЖроХрпБро▒ро╛ройрпН ЁЯФМ
    ЁЯЦе Server: тАЬOK ЁЯСНтАЭ

рокро┐ро▒роХрпБтАж
    ЁЯЦе Server: тАЬNew message ро╡роирпНродрпБроЪрпНроЪрпБ!тАЭ
    ЁЯСд Client: роЙроЯройрпЗ receive рокрогрпНрогро┐роХрпНроХрпБро▒ро╛ройрпН ЁЯШО

ЁЯСЙ роЗродрпБродро╛ройрпН WebSocket magic тЬи
            </pre>
            <hr>
            <p><b>ЁЯФМ WebSocket</b></p>
            <p>WebSocket creates a single long-lived connection.</p>
            <p>Once connected:</p>
            <ul>
                <li>тЬФ Client can send anytime
                </li>
                <li>тЬФ Server can push anytime
                </li>
                <li>тЬФ No need to re-open connection
                </li>
                <li>тЬФ Very low overhead
                </li>
                <li>тЬФ Near-instant delivery
                </li>
            </ul>
            <pre>ЁЯУМ Example (WebSocket)

Chat app:
Client connects once.

Then:
Server тЖТ тАЬNew message arrived ЁЯТмтАЭ
Client receives immediately.

No repeated asking.
            </pre>
        </div>
    </div>
</div>
<div class="container alert alert-primary">
    <div class="row">
        <div class="col">
            <h6>ЁЯза When Should You Use WebSockets?</h6>
            <p> Use WebSockets when:
            </p>
            <ul>
                <li>тЬЕ You need instant updates
                </li>
                <li>тЬЕ Many small messages
                </li>
                <li>тЬЕ Live dashboards
                </li>
                <li>тЬЕ Multiplayer games
                </li>
                <li>тЬЕ Collaboration tools
                </li>
                <li>тЬЕ Chat systems
                </li>
                <li>тЬЕ IoT telemetry
                </li>
            </ul>
        </div>
        <div class="col">
            <p> DonтАЩt use them for:
            </p>
            <ul>
                <li>тЭМ Simple CRUD APIs
                </li>
                <li>тЭМ Page loads
                </li>
                <li>тЭМ One-time fetch data
                </li>
            </ul>
        </div>
    </div>
</div>
<div class="container card alert alert-success">
    <div class="row">
        <h4 class="title">ЁЯТм Angular WebSocket Demo</h4>
        <div class="connection-status" [ngClass]="connectionStatus">
            <span *ngIf="connectionStatus === 'connected'">ЁЯЯв Connected</span>
            <span *ngIf="connectionStatus === 'reconnecting'">ЁЯЯб ReconnectingтАж</span>
            <span *ngIf="connectionStatus === 'disconnected'">ЁЯФ┤ Disconnected</span>
        </div>
        <!-- JOIN -->
        <div *ngIf="!joined" class="join-box">
            <div class="row">
                <div class="col-4">
                    <input [(ngModel)]="username" class="form-control" placeholder="Enter your name" />
                </div>
                <div class="col">
                    <button class="btn btn-info rounded" (click)="joinChat()">Join Chat</button>
                </div>
            </div>
        </div>
        <div class="chat-container">
            <!-- CHAT -->
            <div *ngIf="joined" class="chat-box">
                <!-- Messages -->
                <div class="messages" #scrollMe>

                    <ng-container *ngFor="let msg of messages; let i = index">

                        <!-- Day Separator -->
                        <div *ngIf="isNewDay(i)" class="day-separator">
                            {{ getDayLabel(msg.timestamp ?? 0) }}
                        </div>

                        <!-- Message Wrapper -->
                        <div class="message-row" [class.mine-row]="msg.user === username">

                            <!-- Bubble -->
                            <div class="bubble" [class.mine]="msg.user === username">

                                <div class="sender">{{ msg.user }}</div>

                                <div class="text">{{ msg.text }}</div>

                                <div class="meta">
                                    <span class="time">
                                        {{ msg.timestamp | date:'shortTime' }}
                                    </span>

                                    <span class="ticks" *ngIf="msg.user === username">
                                        тЬФтЬФ
                                    </span>
                                </div>

                                <!-- Reactions -->
                                <div class="reactions">

                                    <!-- Existing -->
                                    <span class="reaction" *ngFor="let r of msg.reactions | keyvalue"
                                        (click)="react(msg, r.key)">
                                        {{ r.key }} {{ r.value.length }}
                                    </span>

                                    <!-- Quick -->
                                    <span class="reaction add" (click)="react(msg,'ЁЯСН')">ЁЯСН</span>
                                    <span class="reaction add" (click)="react(msg,'тЭдя╕П')">тЭдя╕П</span>
                                    <span class="reaction add" (click)="react(msg,'ЁЯШВ')">ЁЯШВ</span>
                                    <span class="reaction add" (click)="react(msg,'ЁЯШо')">ЁЯШо</span>

                                </div>

                            </div>

                        </div>

                    </ng-container>

                </div>

                <!-- Input -->
                <div class="typing-indicator" *ngIf="typingUser">
                    {{ typingUser }} is typing...
                </div>
                <input class="chat-input" [(ngModel)]="message" placeholder="Type a message" (keydown.enter)="send()"
                    (input)="notifyTyping()" />
            </div>
        </div>
    </div>
</div>